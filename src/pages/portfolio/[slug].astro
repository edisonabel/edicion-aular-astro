---
import BaseLayout from '../../layouts/BaseLayout.astro';
import portfolioData from '../../data/portfolio.json';

export function getStaticPaths() {
  return portfolioData.map((project, index) => ({
    params: { slug: project.slug },
    props: { 
      project,
      nextProject: portfolioData[(index + 1) % portfolioData.length]
    }
  }));
}

const { project, nextProject } = Astro.props;
const layout = project.layout || 'default';
---

<BaseLayout 
    title={`${project.title} | Portafolio | Edición Aular`}
    description={project.description}
>
    <div class="stg-container">

        {/* LAYOUT BENTO - Pop Warner */}
        {layout === 'bento' && (
            <section>
                <div class="bringer-bento-grid stg-bottom-gap-l">
                    <div class="is-large" data-appear="fade-right" data-unload="fade-left">
                        <img src={project.images.gallery[4]} alt={project.title} width="1200" height="1200">
                    </div>
                    <div class="is-medium bringer-block stg-vertical-space-between" data-appear="fade-down" data-delay="100" data-unload="fade-right">
                        <h1>{project.title}</h1>
                        <p class="bringer-large-text">{project.description}</p>
                    </div>
                    <div class="is-small bringer-block" data-appear="fade-up" data-delay="100" data-unload="fade-left">
                        <ul class="bringer-meta-list">
                            <li>
                                <span class="bringer-meta">Cliente:</span>
                                <span class="bringer-highlight">{project.client}</span>
                            </li>
                            <li>
                                <span class="bringer-meta">Servicio:</span>
                                <span class="bringer-highlight">{project.service}</span>
                            </li>
                            <li>
                                <span class="bringer-meta">Fecha:</span>
                                <span class="bringer-highlight">{project.year}</span>
                            </li>
                            {project.website && (
                                <li>
                                    <a href={project.website} class="bringer-arrow-link margin-vertical" target="_blank">Ir a la Website</a>
                                </li>
                            )}
                        </ul>
                    </div>
                    <div class="is-small" data-appear="fade-left" data-delay="200" data-unload="fade-right">
                        <img src={project.images.hero[2]} alt={project.title} width="960" height="960">
                    </div>
                </div>
            </section>
        )}

        {/* LAYOUT SIMPLE - Agro, Bee, America (h1 + slider sin máscara + navegación on-sides) */}
        {(layout === 'simple' || layout === 'default') && (
            <section>
                <div class="stg-row stg-bottom-gap-l stg-tp-bottom-gap">
                    <div class="stg-col-6 stg-tp-bottom-gap">
                        <h1 class="bringer-post-title" data-appear="fade-up" data-unload="fade-left">{project.title}</h1>
                    </div>
                    <div class="stg-col-6 stg-tp-col-9 stg-tp-offset-3 align-right" data-appear="fade-up" data-delay="100" data-unload="fade-right">
                        <p>{project.description}</p>
                    </div>
                </div>

                {/* Slider sin máscara */}
                <div class="bringer-slider-wrapper stg-bottom-gap" data-appear="fade-up" data-delay="200" data-unload="fade-up">
                    <div class="swiper bringer-slider" data-autoplay="2000" data-duration="800" data-effect="slide">
                        <div class="swiper-wrapper">
                            {project.images.hero.map((img) => (
                                <div class="swiper-slide">
                                    <img src={img} alt={project.title} width="1920" height="1080">
                                </div>
                            ))}
                        </div>
                    </div>
                    {/* Navegación a los lados */}
                    <div class="bringer-slider-nav on-sides">
                        <a href="#" class="bringer-slider-prev">
                            <span class="bringer-icon bringer-icon-arrow-left"></span>
                        </a>
                        <a href="#" class="bringer-slider-next">
                            <span class="bringer-icon bringer-icon-arrow-right"></span>
                        </a>
                    </div>
                </div>

                {/* Meta */}
                <div class="bringer-hero-info-line" data-stagger-appear="fade-up" data-delay="200" data-stagger-delay="100" data-unload="fade-up">
                    <div class="bringer-meta">
                        Cliente: <span>{project.client}</span>
                    </div>
                    <div class="bringer-meta">
                        Servicio: <span>{project.service}</span>
                    </div>
                    <div class="bringer-meta">
                        Fecha: <span>{project.year}</span>
                    </div>
                </div>
            </section>
        )}

        {/* LAYOUT MASKED - Dr. Jarod, Ecosolares (h2 + slider con máscara + navegación at-bottom-right) */}
        {layout === 'masked' && (
            <section class="backlight-bottom">
                <div class="stg-row stg-bottom-gap-l">
                    <div class="stg-col-8 stg-tp-bottom-gap" data-appear="fade-right" data-unload="fade-left">
                        <h2>{project.title}</h2>
                    </div>
                    <div class="stg-col-4 stg-tp-col-8 stg-tp-offset-4 tp-align-right stg-m-col-9 stg-m-offset-3" data-appear="fade-left" data-unload="fade-right">
                        <p>{project.description}</p>
                    </div>
                </div>

                {/* Slider con máscara */}
                <div class="bringer-slider-wrapper bringer-masked-block stg-bottom-gap" data-appear="fade-up" data-delay="100" data-unload="fade-up">
                    <div class="swiper bringer-slider bringer-masked-media" data-autoplay="2000" data-duration="800" data-effect="slide">
                        <div class="swiper-wrapper">
                            {project.images.hero.map((img) => (
                                <div class="swiper-slide">
                                    <img src={img} alt={project.title} width="1920" height="1080">
                                </div>
                            ))}
                        </div>
                    </div>
                    {/* Navegación en esquina inferior derecha */}
                    <div class="bringer-slider-nav bringer-masked-content at-bottom-right">
                        <a href="#" class="bringer-slider-prev">
                            <span class="bringer-icon bringer-icon-chevron-left"></span>
                        </a>
                        <a href="#" class="bringer-slider-next">
                            <span class="bringer-icon bringer-icon-chevron-right"></span>
                        </a>
                    </div>
                </div>

                {/* Meta */}
                <div class="bringer-hero-info-line" data-stagger-appear="fade-up" data-delay="200" data-unload="fade-up">
                    <div class="bringer-meta">
                        Cliente: <span>{project.client}</span>
                    </div>
                    <div class="bringer-meta">
                        Servicio: <span>{project.service}</span>
                    </div>
                    <div class="bringer-meta">
                        Fecha: <span>{project.year}</span>
                    </div>
                </div>
            </section>
        )}

        <!-- Section: El Desafío -->
        {project.content?.challenge && (
            <section data-padding="top" class="backlight-top">
                <div class="stg-row stg-bottom-gap-l">
                    <div class="stg-col-6 stg-tp-bottom-gap" data-appear="fade-right" data-unload="fade-left">
                        <h2>El Desafío</h2>
                    </div>
                    <div class="stg-col-6 stg-tp-col-10 stg-tp-offset-2" data-appear="fade-left" data-unload="fade-right">
                        <p class="bringer-large-text">{project.content.challenge}</p>
                    </div>
                </div>
                {project.images?.gallery && project.images.gallery[0] && (
                    <div class="stg-row" data-appear="fade-up" data-unload="zoom-out">
                        <div class="stg-col-6 stg-offset-3 stg-tp-col-8 stg-tp-offset-2">
                            <img src={project.images.gallery[0]} alt={project.title} width="1200" height="1200">
                        </div>
                    </div>
                )}
            </section>
        )}

        <!-- Section: Nuestro Enfoque -->
        {project.content?.approach && (
            <section data-padding="top">
                <div class="stg-row stg-bottom-gap">
                    <div class="stg-col-6">
                        <h2 data-appear="fade-up" data-unload="fade-left">Nuestro Enfoque</h2>
                    </div>
                </div>
                <div class="stg-row stg-bottom-gap-l" data-appear="fade-up" data-delay="100" data-unload="fade-right">
                    <div class="stg-col-9 stg-offset-3 stg-tp-col-10 stg-tp-offset-2">
                        <p class="bringer-large-text">{project.content.approach}</p>
                    </div>
                </div>
                {project.images?.gallery && project.images.gallery[1] && (
                    <div class="stg-row" data-appear="fade-left" data-unload="fade-left">
                        <div class="stg-col-9">
                            <img src={project.images.gallery[1]} alt={project.title} width="1200" height="1200">
                        </div>
                    </div>
                )}
            </section>
        )}

        <!-- Section: La Solución -->
        {project.content?.solution && (
            <section data-padding="top">
                <div class="stg-row stg-bottom-gap-l">
                    <div class="stg-col-6 stg-tp-bottom-gap" data-appear="fade-right" data-unload="fade-left">
                        <h2>La Solución</h2>
                    </div>
                    <div class="stg-col-6 stg-tp-col-10 stg-tp-offset-2" data-appear="fade-left" data-unload="fade-right">
                        <p class="bringer-large-text">{project.content.solution}</p>
                    </div>
                </div>

                <!-- Gallery -->
                {project.images?.gallery && project.images.gallery.length >= 5 && (
                    <div class="bringer-grid-3cols" data-stagger-appear="fade-up" data-stagger-unload="fade-left">
                        <div>
                            <img src={project.images.gallery[2]} alt={project.title} width="800" height="1200">
                        </div>
                        <div>
                            <img src={project.images.gallery[3]} alt={project.title} width="800" height="1200">
                        </div>
                        <div>
                            <img src={project.images.gallery[4]} alt={project.title} width="800" height="1200">
                        </div>
                    </div>
                )}
            </section>
        )}

        <!-- Section: Resultados e Impacto -->
        {project.content?.results && (
            <section>
                <div class="stg-row stg-bottom-gap">
                    <div class="stg-col-6" data-appear="fade-up" data-unload="fade-left">
                        <h2>Resultados e Impacto</h2>
                    </div>
                </div>
                <div class="stg-row" data-appear="fade-up" data-delay="100" data-unload="fade-right">
                    <div class="stg-col-10 stg-offset-2">
                        <p class="bringer-large-text">{project.content.results}</p>
                    </div>
                </div>
            </section>
        )}

        <!-- Section: Next Project -->
        <section class="divider-top">
            <div class="align-center" data-unload="zoom-in">
                <a href={`/portfolio/${nextProject.slug}`} class="bringer-icon-link bringer-next-post">
                    <div class="bringer-icon-link-content">
                        <h6>Próximo Proyecto</h6>
                        <h2>{nextProject.title}</h2>
                    </div>
                    <div class="bringer-icon-wrap">
                        <i class="bringer-icon bringer-icon-explore"></i>
                    </div>
                </a>
            </div>
        </section>
    </div>
</BaseLayout>
