---
import ThemeToggle from '../components/ThemeToggle.astro';

const { 
    title = 'EdiciÃ³n Aular | ðŸš€ Agencia de SEO y Publicidad Digital ðŸ“ˆ', 
    description = 'Somos una agencia de publicidad digital especializada en SEO ðŸ“ˆ, diseÃ±o web ðŸ’», branding ðŸŽ¨, producciÃ³n audiovisual ðŸŽ¥, gestiÃ³n de Ads ðŸ“Š y mentorÃ­a ðŸ§ . Â¡Transforma tu marca! âœ¨',
    image = '/img/social-edicion.webp' // Imagen por defecto
} = Astro.props;

const socialImage = new URL(image, Astro.site).href;
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Page Title -->
    <title>{title}</title>
    
    <!-- Meta Description -->
    <meta name="description" content={description}>

    <!-- Canonical URL -->
    <link rel="canonical" href={Astro.url.href} />
    <meta name="google-site-verification" content="1CWG9HSA1bg0q-_Qq2kOPN1rDgFWFYdh0BQ8I5fnklc" />
    
    <!-- DNS Prefetch y Preconnect optimizados -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://tresmarketing.s3.us-east-1.amazonaws.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://tresmarketing.s3.us-east-1.amazonaws.com">
    
    <!-- Preload crÃ­tico para HOME hero poster y CSS -->
    {Astro.url.pathname === '/' && (
        <>
            <link rel="preload" as="image" href="/img/home/home03-hero2.jpg" fetchpriority="high" importance="high">
            <link rel="preload" as="style" href="/css/config.css">
            <link rel="preload" as="style" href="/css/style.css">
            <link rel="preload" as="script" href="/js/lib/jquery.min.js">
        </>
    )}
    <!-- Google Fonts (optimizado con preload + font-display swap) -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    </noscript>
    
    <!-- CSS crÃ­tico inline en HEAD, resto async -->
    <link rel="stylesheet" href="/css/config.css">
    <link rel="stylesheet" href="/css/libs.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/responsive.css" media="all">
    <!-- Light Mode Theme (async load) -->
    <link rel="stylesheet" href="/css/theme-light.css" media="print" onload="this.media='all'">
    <!-- Fullwidth Fix (async load) -->
    <link rel="stylesheet" href="/css/fullwidth-fix.css" media="print" onload="this.media='all'">
    <!-- CTA Gradient (async load) -->
    <link rel="stylesheet" href="/css/cta-gradient.css" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="/css/theme-light.css">
        <link rel="stylesheet" href="/css/fullwidth-fix.css">
        <link rel="stylesheet" href="/css/cta-gradient.css">
    </noscript>
    
    <!-- Favicon y PWA -->
    <link rel="icon" href="/img/favicon (1).svg" sizes="32x32">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ff0080">
    
    <!-- Metadatos Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={Astro.url.href} />
    <meta property="og:site_name" content="EdiciÃ³n Aular" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content={socialImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    
    <!-- Metadatos Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={socialImage} />
    
    <!-- Google tag (gtag.js) - Carga diferida -->
    <script>
        window.addEventListener('load', function() {
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-2CTQCP83WM';
            script.async = true;
            document.head.appendChild(script);
            
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-2CTQCP83WM');
        });
    </script>
    
    <!-- Critical CSS para prevenir CLS y optimizaciÃ³n mobile -->
    <style>
        .bringer-large-text {
            font-size: var(--bringer-t-large-fs);
            line-height: var(--bringer-t-content-lh);
            color: var(--bringer-s-heading);
        }
        
        /* Prevenir Layout Shift en imÃ¡genes */
        img[width][height] {
            height: auto;
            aspect-ratio: attr(width) / attr(height);
        }
        
        /* Hero video container */
        .bringer-hero-media video {
            width: 100%;
            height: auto;
            aspect-ratio: 16/9;
        }
        
        /* Portfolio cards */
        .bringer-portfolio-card-image {
            position: relative;
            aspect-ratio: 1/1;
            overflow: hidden;
        }
        
        .bringer-portfolio-card-image img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Skeleton loading para mejor UX */
        .bringer-lazy[data-src]:not([src]) {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* OptimizaciÃ³n de fuentes para mejor render */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* GPU acceleration para elementos animados */
        [data-appear], 
        .swiper-slide,
        .bringer-carousel {
            will-change: transform, opacity;
        }
        
        /* Contenido above-the-fold visible inmediatamente */
        .bringer-page-title {
            font-size: clamp(2rem, 5vw, 4rem);
            line-height: 1.2;
        }
        
        /* OPTIMIZACIONES MOBILE-FIRST */
        
        /* Touch targets mÃ­nimos 44x44px (WCAG) */
        a, button, input, select, textarea {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Mejorar tap highlights */
        * {
            -webkit-tap-highlight-color: rgba(255, 0, 128, 0.2);
            tap-highlight-color: rgba(255, 0, 128, 0.2);
        }
        
        /* Prevenir zoom en inputs (mobile) */
        @media screen and (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }
        
        /* Optimizar scroll en mobile */
        html {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        
        /* Reducir motion para usuarios sensibles */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Container queries para componentes responsive */
        @supports (container-type: inline-size) {
            .bringer-portfolio-card {
                container-type: inline-size;
            }
        }
    </style>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(() => {});
            });
        }
    </script>
    
    <!-- Prefetch pÃ¡ginas comunes para navegaciÃ³n instantÃ¡nea -->
    {Astro.url.pathname === '/' && (
        <>
            <link rel="prefetch" href="/nosotros" as="document">
            <link rel="prefetch" href="/portfolio" as="document">
        </>
    )}
</head>

<body>
    <!-- Header -->
    <header id="bringer-header" class="is-frosted is-sticky" data-appear="fade-down" data-unload="fade-up">
        <!-- Desktop Header -->
        <div class="bringer-header-inner">
            <!-- Header Logo -->
            <div class="bringer-header-lp">
                <a href="/" class="bringer-logo">
                    <img src="/img/Edicion-Aular-Logo.svg" alt="Logo de EdiciÃ³n Aular, Agencia de Publicidad Digital" width="130" height="70">
                </a>
            </div>
            
            <!-- Main Menu -->
            <div class="bringer-header-mp">
                <nav class="bringer-nav">
                    <ul class="main-menu" data-stagger-appear="fade-down" data-stagger-delay="75">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        <li>
                            <a href="/nosotros">Nosotros</a>
                        </li>
                        <li>
                            <a href="#">Servicios</a>
                            <ul class="sub-menu">
                                <li><a href="/lanzamientos-digitales">Lanzamientos</a></li>
                                <li><a href="/diseno-web">DiseÃ±o Web</a></li>
                                <li><a href="/branding">Branding</a></li>
                                <li><a href="/produccion-audiovisual">Audiovisuales</a></li>
                                <li><a href="/meta-ads-google-ads">Meta & Google Ads</a></li>
                                <li><a href="/streaming">Streaming Profesional</a></li>
                                <li><a href="/mentoria">MentorÃ­a de Marca</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="/portfolio">Portafolio</a>
                        </li>
                        <li>
                            <a href="/blog">Blog</a>
                        </li>
                        <li>
                            <a href="/contacto">Contacto</a>
                        </li>
                    </ul>
                </nav>
            </div>
            
            <!-- Header Button -->
            <div class="bringer-header-rp" style="display: flex; align-items: center;">
                <a href="https://cal.com/edicion-aular-website" class="bringer-button">Agenda una Cita</a>
                <ThemeToggle />
            </div>
        </div>

        <!-- Mobile Header -->
        <div class="bringer-mobile-header-inner">
            <a href="/" class="bringer-logo">
                <img src="/img/Edicion-Aular-Logo.svg" alt="Logo de EdiciÃ³n Aular, Agencia de Publicidad Digital" width="120" height="60">
            </a>
            <a href="#" class="bringer-mobile-menu-toggler">
                <i class="bringer-menu-toggler-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </i>
            </a>
        </div>
    </header>

    <!-- Page Main -->
    <main id="bringer-main">
        <slot />
    </main>

    <!-- Footer -->
    <footer id="bringer-footer" data-appear="fade-up" data-unload="fade-down">
        <!-- Footer Widgets Area -->
        <div class="bringer-footer-widgets">
            <div class="stg-container">
                <div class="stg-row" data-stagger-appear="fade-left" data-stagger-delay="100">
                    <div class="stg-col-5 stg-tp-col-12 stg-tp-bottom-gap-l">
                        <div class="bringer-info-widget">
                            <a href="/" class="bringer-logo footer-logo">
                                <img src="/img/Edicion-Aular-Logo.png" alt="Logo de EdiciÃ³n Aular" width="130" height="70">
                            </a>
                            <div class="bringer-info-description">Somos un equipo de diseÃ±adores, desarrolladores y estrategas de marketing comprometidos con llevar negocios de todos los tamaÃ±os al siguiente nivel. Con aÃ±os de experiencia, diseÃ±amos soluciones que conectan con audiencias y generan resultados.</div>
                            <span class="bringer-label">SÃ­guenos:</span>
                            <ul class="bringer-socials-list" data-stagger-appear="fade-up" data-stagger-delay="75">
                                <li><a href="https://www.facebook.com/edicionaular" target="_blank" class="bringer-socials-facebook"><i></i></a></li>
                                <li><a href="https://www.instagram.com/edicion_aular/" target="_blank" class="bringer-socials-instagram"><i></i></a></li>
                                <li><a href="https://vimeo.com/user67007640" target="_blank" class="bringer-socials-vimeo"><i></i></a></li>
                                <li><a href="https://www.tiktok.com/@edicionaular8" target="_blank" class="bringer-socials-tiktok"><i></i></a></li>
                                <li><a href="https://wa.link/tjepy5" target="_blank" class="bringer-socials-whatsapp"><i></i></a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="stg-col-2 stg-offset-1 stg-tp-col-4 stg-m-col-4">
                        <div class="bringer-widget">
                            <h6>Servicios</h6>
                            <div class="bringer-menu-widget">
                                <ul>
                                    <li><a href="/lanzamientos-digitales">Lanzamientos</a></li>
                                    <li><a href="/diseno-web">DiseÃ±o Web</a></li>
                                    <li><a href="/branding">Branding</a></li>
                                    <li><a href="/produccion-audiovisual">Audiovisuales</a></li>
                                    <li><a href="/meta-ads-google-ads">Meta & Google Ads</a></li>
                                    <li><a href="/streaming">Streaming Profesional</a></li>
                                    <li><a href="/mentoria">MentorÃ­a de Marca</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="stg-col-2 stg-tp-col-4 stg-m-col-4">
                        <div class="bringer-widget">
                            <h6>Nosotros</h6>
                            <div class="bringer-menu-widget">
                                <ul>
                                    <li><a href="/nosotros">Acerca de</a></li>
                                    <li><a href="#">Mi Equipo</a></li>
                                    <li><a href="#">Testimonios</a></li>
                                    <li><a href="/contacto">Contacto</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="stg-col-2 stg-tp-col-4 stg-m-col-4">
                        <div class="bringer-widget">
                            <h6>Recursos</h6>
                            <div class="bringer-menu-widget">
                                <ul>
                                    <li><a href="/blog">Blog</a></li>
                                    <li><a href="/faq">Preguntas Frecuentes</a></li>
                                    <li><a href="/servicios">Nuestros Servicios</a></li>
                                    <li><a href="#">TÃ©rminos y Condiciones</a></li>
                                    <li><a href="#">PolÃ­tica de Privacidad</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Copyright Line -->
        <div class="bringer-footer-line">
            <div class="stg-container">
                <div class="align-center">
                    Copyright &copy; EdiciÃ³n Aular 2025. Todos los Derechos Reservados.
                </div>
            </div>
        </div>
    </footer>

    <!-- Right Click Protection Block -->
    <div class="bringer-rcp-wrap">
        <div class="bringer-rcp-overlay"></div>
        <div class="bringer-rcp-container">
            <h2>Copiar datos de la pÃ¡gina no esta permitido ðŸ˜”</h2>
            <p>Pero puedes seguir navegando y viendo el tiempo que tu quieras ðŸ˜‰</p>
        </div>
    </div>

    <!-- Portfolio Images Fix -->
    <script is:inline>
        function fixPortfolioImages() {
            document.querySelectorAll('.bringer-portfolio-card-image').forEach(c => {
                c.style.cssText = 'position:relative!important;aspect-ratio:1/1!important;overflow:hidden!important';
            });
            document.querySelectorAll('.bringer-portfolio-card-image .st-lazy-wrapper').forEach(w => {
                w.style.cssText = 'position:absolute!important;inset:0!important;width:100%!important;height:100%!important;opacity:1!important;visibility:visible!important;display:block!important;min-height:300px!important';
            });
            document.querySelectorAll('.bringer-portfolio-card-image img,.bringer-portfolio-card-image video').forEach(i => {
                i.removeAttribute('width');
                i.removeAttribute('height');
                i.style.cssText = 'position:absolute!important;inset:0!important;width:100%!important;height:100%!important;object-fit:cover!important;opacity:1!important;visibility:visible!important;display:block!important';
            });
        }
        if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',fixPortfolioImages)}else{fixPortfolioImages()}
        setTimeout(fixPortfolioImages,800);
        setTimeout(fixPortfolioImages,1500);
    </script>

    <!-- Dynamic Backlight -->
    <div class="bringer-backlight"></div>

    <!-- Scripts (mantener orden por dependencias) -->
    <script is:inline src="/js/lib/jquery.min.js"></script>
    <script is:inline src="/js/lib/libs.js"></script>
    <script is:inline src="/js/st-core.js"></script>
    <script is:inline src="/js/classes.js"></script>
    
    <!-- Main.js con espera a DOM ready -->
    <script is:inline>
        (function() {
            function initApp() {
                // Cargar main.js solo cuando el DOM estÃ© listo
                var script = document.createElement('script');
                script.src = '/js/main.js?v=astro2025';
                document.body.appendChild(script);
            }
            
            // Para navegaciÃ³n inicial
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initApp);
            } else {
                initApp();
            }
            
            // Para transiciones de Astro (si las hay)
            document.addEventListener('astro:page-load', initApp);
        })();
    </script>

    <!-- Active Menu Script -->
    <script is:inline>
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const menuItems = document.querySelectorAll('.main-menu > li');
            const subMenuItems = document.querySelectorAll('.sub-menu li');
            
            // Remove all current-menu-item and current-menu-parent classes from main menu
            menuItems.forEach(item => {
                item.classList.remove('current-menu-item', 'current-menu-parent');
            });
            
            // Remove all current-menu-item classes from submenu
            subMenuItems.forEach(item => {
                item.classList.remove('current-menu-item');
            });
            
            // Check submenu items first
            let submenuMatched = false;
            subMenuItems.forEach(item => {
                const link = item.querySelector('a');
                if (!link) return;
                
                const href = link.getAttribute('href');
                
                // Check if current page matches a submenu item
                if (href === currentPath) {
                    item.classList.add('current-menu-item');
                    // Mark parent "Servicios" as current-menu-parent
                    const servicesItem = Array.from(menuItems).find(mi => 
                        mi.querySelector('a')?.textContent.trim() === 'Servicios'
                    );
                    if (servicesItem) {
                        servicesItem.classList.add('current-menu-parent');
                    }
                    submenuMatched = true;
                }
            });
            
            // If no submenu matched, check main menu items
            if (!submenuMatched) {
                menuItems.forEach(item => {
                    const link = item.querySelector('a');
                    if (!link) return;
                    
                    const href = link.getAttribute('href');
                    
                    // Check for exact match
                    if (href === currentPath || (currentPath === '/' && href === '/')) {
                        item.classList.add('current-menu-item');
                    } else if (currentPath.includes(href) && href !== '/' && href !== '#') {
                        item.classList.add('current-menu-item');
                    }
                });
            }

            // FORCE pink color for active menu indicator in light mode
            function updateMenuColors() {
                const isLightMode = document.documentElement.classList.contains('light-mode');
                if (isLightMode) {
                    // Force pink color for main menu indicators
                    const activeMenuLinks = document.querySelectorAll('.main-menu > li.current-menu-item > a, .main-menu > li.current-menu-parent > a');
                    activeMenuLinks.forEach(link => {
                        const style = document.createElement('style');
                        style.textContent = `
                            html.light-mode .main-menu > li.current-menu-item > a::after,
                            html.light-mode .main-menu > li.current-menu-parent > a::after {
                                background-color: #ff0080 !important;
                                background: #ff0080 !important;
                            }
                        `;
                        if (!document.getElementById('menu-pink-override')) {
                            style.id = 'menu-pink-override';
                            document.head.appendChild(style);
                        }
                    });
                }
            }

            // Run on load
            updateMenuColors();

            // Also run when theme changes
            const observer = new MutationObserver(updateMenuColors);
            observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
        });
    </script>
</body>
</html>
