--- 
// ARCHIVO RECONSTRUIDO DESDE CERO - PASO 1
import BaseLayout from '../../layouts/BaseLayout.astro';
import blogData from '../../data/blog.json';

// Lógica para obtener los datos del post
export async function getStaticPaths() {
    return blogData.map(post => ({
        params: { slug: post.slug },
        props: { post }
    }));
}

const { post } = Astro.props;

// Formatear fecha para la metadata
const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('es-ES', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
};
---

<BaseLayout 
    title={`${post.title} | Blog Edición Aular`}
    description={post.excerpt}>

    <div class="stg-container">
        <!-- PASO 1: Encabezado del Artículo -->
        <section style="padding-bottom: 1rem;">
            <div class="bringer-page-intro">
                <div class="stg-row">
                    <div class="stg-col-8 stg-offset-2">
                        <!-- Breadcrumb -->
                        <nav class="bringer-breadcrumb">
                            <ul>
                                <li><a href="/">Home</a></li>
                                <li><a href="/blog">Blog</a></li>
                                <li><span>{post.category}</span></li>
                            </ul>
                        </nav>

                        <!-- Título -->
                        <h1 class="bringer-page-title">
                            {post.title}
                        </h1>

                        <!-- Meta Info -->
                        <div class="bringer-post-meta">
                            <div class="bringer-post-author">
                                <span class="bringer-meta">Por <strong>{post.author}</strong></span>
                            </div>
                            <span class="bringer-meta">•</span>
                            <span class="bringer-meta">{formatDate(post.date)}</span>
                            <span class="bringer-meta">•</span>
                            <span class="bringer-meta">{post.readTime} de lectura</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- IMAGEN DEL BLOG CON ANIMACIÓN -->
        <section class="is-fullwidth" style="padding: 2rem 0 3rem 0;">
            <div class="stg-row">
                <div class="stg-col-8 stg-offset-2">
                    <div class="st-expandable-wrap">
                        <div class="bringer-expand-on-scroll">
                            <img src={post.image} alt={post.title} width="1200" height="630" data-unload="fade-up" />
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CONTENIDO DEL ARTÍCULO -->
        <section style="padding-top: 0;">
            <div class="stg-row">
                <div class="stg-col-8 stg-offset-2">
                    <article class="bringer-post-content">
                        <!-- Resumen -->
                        <div class="bringer-post-excerpt">
                            <p class="bringer-large-text">{post.excerpt}</p>
                        </div>

                        <!-- Contenido Principal -->
                        <div class="bringer-post-body">
                            {/* Contenido HTML directo desde el JSON */}
                            <div set:html={post.content} />

                            <div class="stg-top-gap-l">
                                <blockquote class="bringer-blockquote">
                                    <p>"La diferencia entre el éxito y el fracaso está en implementar lo que aprendes, no solo en saberlo."</p>
                                    <cite>— Edison Aular, Fundador de Edición Aular</cite>
                                </blockquote>
                            </div>

                            <h2>¿Por Qué Esto Funciona?</h2>
                            <p>Esta estrategia ha sido probada por miles de negocios exitosos alrededor del mundo. No es teoría, es un sistema comprobado que genera resultados reales cuando se implementa correctamente.</p>

                            <p>La clave está en entender que no necesitas reinventar la rueda. Los emprendedores más exitosos no crean estrategias desde cero, adaptan y aplican lo que ya funciona a su contexto específico.</p>

                            <h2>Tu Siguiente Paso</h2>
                            <p>Ahora que conoces esta estrategia, tienes dos opciones:</p>
                            <ul>
                                <li><strong>Opción 1:</strong> Intentar implementarla tú solo (puede tomar meses de prueba y error)</li>
                                <li><strong>Opción 2:</strong> Trabajar con expertos que ya han ayudado a cientos de negocios a implementarla exitosamente</li>
                            </ul>

                            <p>En Edición Aular, no solo te enseñamos la teoría, te ayudamos a implementarla paso a paso en tu negocio. Agenda una consultoría gratuita y descubre cómo podemos acelerar tus resultados.</p>
                        </div>
                    </article>
                </div>
            </div>
        </section>

        <!-- PASO 3: CTA (Call to Action) -->
        <section class="divider-top">
            <div class="stg-row">
                <div class="stg-col-8 stg-offset-2">
                    <div class="bringer-cta-box bringer-block align-center">
                        <h3>¿Te Gustó Este Artículo?<span class="bringer-accent">.</span></h3>
                        <p class="bringer-large-text">
                            Agenda una consultoría gratuita y descubre cómo podemos ayudarte a implementar estas estrategias en tu negocio.
                        </p>
                        <div class="stg-top-gap">
                            <a href="https://cal.com/edicion-aular-website" class="bringer-button">Agendar Consultoría</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

</BaseLayout>

<script>
    // Efecto de expansión de imagen al hacer scroll
    document.addEventListener('DOMContentLoaded', () => {
        const expandableImages = document.querySelectorAll('.bringer-expand-on-scroll');
        
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.2
        };

        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-init');
                }
            });
        }, observerOptions);

        expandableImages.forEach(img => {
            imageObserver.observe(img);
        });
    });
</script>

<style>
    /* Estilos mínimos para esta fase */
    .bringer-breadcrumb ul {
        display: flex;
        gap: 0.5rem;
        list-style: none;
        padding: 0;
        margin: 0 0 1.5rem 0;
        font-size: 0.875rem;
    }
    .bringer-breadcrumb li:not(:last-child)::after {
        content: '/';
        margin-left: 0.5rem;
    }
    .bringer-post-meta {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--bringer-s-border);
    }
    .bringer-post-content {
        font-size: 1.0625rem;
        line-height: 1.9; /* Aumentado de 1.8 a 1.9 */
    }
    
    /* Títulos con espaciado UX/UI optimizado - FORZAR CON !important */
    .bringer-post-body h2 {
        margin-top: 5rem !important;
        margin-bottom: 2rem !important;
        padding-top: 1.5rem !important;
        line-height: 1.3 !important;
    }
    
    .bringer-post-body h3 {
        margin-top: 4rem !important;
        margin-bottom: 1.75rem !important;
        padding-top: 1rem !important;
        line-height: 1.4 !important;
    }
    
    .bringer-post-body h4 {
        margin-top: 3.5rem !important;
        margin-bottom: 1.5rem !important;
        padding-top: 0.75rem !important;
        line-height: 1.4 !important;
    }
    
    /* Espacio extra cuando títulos vienen después de listas o párrafos */
    /* Targeting section context through any wrapper divs */
    .bringer-post-body section ul + h2,
    .bringer-post-body section ol + h2,
    .bringer-post-body section p + h2,
    .bringer-post-body div section ul + h2,
    .bringer-post-body div section ol + h2,
    .bringer-post-body div section p + h2 {
        margin-top: 7rem !important;
        padding-top: 2rem !important;
    }
    
    .bringer-post-body section ul + h3,
    .bringer-post-body section ol + h3,
    .bringer-post-body section p + h3,
    .bringer-post-body div section ul + h3,
    .bringer-post-body div section ol + h3,
    .bringer-post-body div section p + h3 {
        margin-top: 6rem !important;
        padding-top: 1.5rem !important;
    }
    
    /* Títulos después de items de lista individuales */
    .bringer-post-body section li:last-child + h2,
    .bringer-post-body section li:last-child + h3,
    .bringer-post-body div section li:last-child + h2,
    .bringer-post-body div section li:last-child + h3 {
        margin-top: 6.5rem !important;
        padding-top: 2rem !important;
    }
    
    /* H2 y H3 dentro de section (regla general adicional) */
    .bringer-post-body section h2,
    .bringer-post-body div section h2 {
        margin-top: 7rem !important;
        padding-top: 2rem !important;
    }
    
    .bringer-post-body section h3,
    .bringer-post-body div section h3 {
        margin-top: 6rem !important;
        padding-top: 1.5rem !important;
    }
    
    /* Excepción: primer h2 de la section */
    .bringer-post-body section > h2:first-child,
    .bringer-post-body div section > h2:first-child {
        margin-top: 0 !important;
        padding-top: 0 !important;
    }
    
    /* Efecto de expansión al scroll - UX/UI Premium */
    .st-expandable-wrap {
        overflow: hidden;
        clip-path: inset(0% round 18px);
        border-radius: 18px;
    }
    
    .bringer-expand-on-scroll {
        transform: scale(1.08);
        transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        will-change: transform;
    }
    
    .bringer-expand-on-scroll.is-init {
        transform: scale(1);
    }
    
    .st-expandable-wrap img {
        width: 100%;
        height: auto;
        display: block;
        object-fit: cover;
        border-radius: 18px;
    }
    
    /* Fallback para navegadores sin clip-path */
    @supports not (clip-path: inset(0% round 18px)) {
        .st-expandable-wrap {
            border-radius: 18px;
            overflow: hidden;
        }
    }
    /* Excerpt con más espacio */
    .bringer-post-excerpt {
        margin-bottom: 3.5rem; /* Aumentado de 2.5rem */
        padding: 2rem 1.75rem; /* Aumentado padding interno */
        background: rgba(var(--bringer-s-accent-rgb), 0.05);
        border-left: 4px solid var(--bringer-s-accent);
        border-radius: 8px;
    }
    
    .bringer-post-excerpt p {
        line-height: 1.9;
        margin: 0;
    }
    
    /* Párrafos con respiración mejorada */
    .bringer-post-body p {
        margin-bottom: 2rem; /* Aumentado de 1.5rem */
        line-height: 2; /* Aumentado de 1.9 */
        letter-spacing: 0.01em; /* Mejor legibilidad */
    }
    
    /* Listas con espacio generoso */
    .bringer-post-body ul,
    .bringer-post-body ol {
        margin: 2.5rem 0; /* Aumentado de 1.5rem */
        padding-left: 2.5rem; /* Aumentado de 2rem */
    }
    
    .bringer-post-body ul li,
    .bringer-post-body ol li {
        margin-bottom: 1.25rem; /* Aumentado de 0.75rem */
        line-height: 1.9; /* Aumentado de 1.7 */
        padding-left: 0.5rem;
    }
    
    .bringer-post-body ul li:last-child,
    .bringer-post-body ol li:last-child {
        margin-bottom: 0;
    }
    
    /* Listas anidadas */
    .bringer-post-body ul ul,
    .bringer-post-body ol ol,
    .bringer-post-body ul ol,
    .bringer-post-body ol ul {
        margin-top: 1rem;
        margin-bottom: 0;
    }
    
    .bringer-post-body strong {
        color: var(--bringer-s-accent);
        font-weight: 600;
    }
    
    /* Blockquote con más aire */
    .bringer-blockquote {
        margin: 3rem 0; /* Más espacio arriba y abajo */
        padding: 2rem 2.5rem; /* Más padding interno */
    }
</style>

<script is:inline>
// Forzar espaciado de títulos h2/h3/h4 para evitar que estén pegados
(function() {
    function applySpacing() {
        const postBody = document.querySelector('.bringer-post-body');
        if (!postBody) return;
        
        const h2Elements = postBody.querySelectorAll('section h2');
        const h3Elements = postBody.querySelectorAll('section h3');
        const h4Elements = postBody.querySelectorAll('section h4');
        
        // Aplicar espaciado a h2 (excepto el primero)
        h2Elements.forEach((h2, index) => {
            if (index > 0) {
                h2.style.setProperty('margin-top', '7rem', 'important');
                h2.style.setProperty('padding-top', '2rem', 'important');
            }
        });
        
        // Aplicar espaciado a h3
        h3Elements.forEach((h3) => {
            h3.style.setProperty('margin-top', '6rem', 'important');
            h3.style.setProperty('padding-top', '1.5rem', 'important');
        });
        
        // Aplicar espaciado a h4
        h4Elements.forEach((h4) => {
            h4.style.setProperty('margin-top', '5rem', 'important');
            h4.style.setProperty('padding-top', '1rem', 'important');
        });
        
        // LIMPIAR <p></p> VACÍOS EN LISTAS (causa saltos de línea innecesarios)
        postBody.querySelectorAll('ol, ul').forEach((list) => {
            list.querySelectorAll('p').forEach((p) => {
                // Si el <p> está vacío o solo tiene espacios/saltos
                if (p.innerHTML.trim() === '' || p.textContent.trim() === '') {
                    p.remove();
                }
            });
        });
    }
    
    // Ejecutar al cargar
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', applySpacing);
    } else {
        applySpacing();
    }
    
    // Re-aplicar por seguridad
    setTimeout(applySpacing, 500);
})();
</script>
